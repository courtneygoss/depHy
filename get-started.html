<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>depHy - Get Started</title>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;600;700&family=Baloo+2:wght@700&display=swap" rel="stylesheet">
  <style>
    :root {
      --color1: #E5ADA8;
      --color2: #E5E0D8;
      --color3: #D0A77B;
      --color4: #725C3F;
      --color5: #EFE8D8;
      --color6: #D8D7B2;
      --glass-bg: rgba(229, 224, 216, 0.45);
      --glass-border: rgba(208, 167, 123, 0.25);
    }
    body {
      font-family: 'IBM Plex Sans', 'Quicksand', 'Segoe UI', Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: var(--color2);
      color: var(--color4);
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }
    .bg-bubbles {
      position: fixed;
      top: 0; left: 0; width: 100vw; height: 100vh;
      z-index: 0;
      pointer-events: none;
    }
    header {
      background: var(--glass-bg);
      color: var(--color4);
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: space-between;
      padding: 1.5rem 2rem 1rem 2rem;
      position: relative;
      min-height: 120px;
      border-bottom: 1.5px solid var(--glass-border);
      box-shadow: 0 8px 32px 0 rgba(114,92,63,0.10);
      backdrop-filter: blur(16px) saturate(1.2);
      -webkit-backdrop-filter: blur(16px) saturate(1.2);
    }
    .header-left {
      display: flex;
      align-items: center;
      gap: 2.2rem;
    }
    .header-right {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }
    .nav-btn {
      background: var(--color3);
      color: var(--color4);
      border: none;
      border-radius: 8px;
      padding: 0.8rem 1.5rem;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 2px 8px rgba(114,92,63,0.08);
      font-family: 'IBM Plex Sans', 'Quicksand', 'Segoe UI', Arial, sans-serif;
      text-decoration: none;
      display: inline-block;
    }
    .nav-btn:hover {
      background: var(--color1);
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 4px 16px rgba(208,167,123,0.2);
      color: var(--color4);
    }
    .nav-btn.primary {
      background: var(--color1);
      color: var(--color4);
    }
    .nav-btn.primary:hover {
      background: var(--color3);
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 4px 16px rgba(208,167,123,0.25);
    }
    .nav-btn.contact-btn {
      background: var(--color6);
      color: var(--color4);
    }
    .nav-btn.contact-btn:hover {
      background: var(--color4);
      color: var(--color6);
    }
    .logo {
      font-size: 2.8rem;
      font-family: 'IBM Plex Sans', 'Quicksand', 'Segoe UI', Arial, sans-serif;
      font-weight: bold;
      letter-spacing: 2px;
      color: var(--color4);
      z-index: 2;
      position: relative;
      text-align: center;
      white-space: nowrap;
      text-shadow: 0 2px 12px rgba(208,167,123,0.08);
    }
    .logo-text {
      font-family: 'IBM Plex Sans', 'Quicksand', 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, var(--color3) 0%, var(--color1) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: drop-shadow(0 2px 8px rgba(208,167,123,0.15));
      font-weight: bold;
    }
    main {
      max-width: 800px;
      margin: 3rem auto 2rem auto;
      background: var(--glass-bg);
      border-radius: 18px;
      box-shadow: 0 8px 32px 0 rgba(114,92,63,0.10);
      border: 1.5px solid var(--glass-border);
      backdrop-filter: blur(16px) saturate(1.2);
      -webkit-backdrop-filter: blur(16px) saturate(1.2);
      padding: 2.5rem 2rem 2rem 2rem;
      z-index: 1;
      position: relative;
    }
    h1 {
      font-size: 2.2rem;
      margin-bottom: 1.2rem;
      color: var(--color4);
      text-align: center;
    }
    .desc {
      font-size: 1.15rem;
      margin-bottom: 2.2rem;
      text-align: center;
      color: var(--color4);
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      font-size: 1.1rem;
    }
    select {
      width: 100%;
      padding: 12px;
      border: 1.5px solid var(--glass-border);
      border-radius: 8px;
      font-size: 16px;
      background: rgba(255,255,255,0.1);
      color: var(--color4);
    }
    select:focus {
      outline: none;
      border-color: var(--color1);
      box-shadow: 0 0 0 3px rgba(229,173,168,0.1);
    }
    button[type="submit"] {
      background: linear-gradient(135deg, var(--color1) 0%, var(--color3) 100%);
      color: var(--color4);
      border: none;
      border-radius: 12px;
      padding: 15px 30px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      margin-top: 20px;
      transition: all 0.3s;
      box-shadow: 0 8px 24px rgba(208,167,123,0.25);
    }
    button[type="submit"]:hover {
      background: linear-gradient(135deg, var(--color3) 0%, var(--color1) 100%);
      transform: translateY(-2px);
      box-shadow: 0 12px 32px rgba(208,167,123,0.35);
    }
    .result {
      margin-top: 30px;
      padding: 25px;
      border-radius: 12px;
      background: rgba(216,215,178,0.3);
      border: 1px solid var(--glass-border);
    }
    .result h3 {
      margin-top: 0;
      color: var(--color4);
      font-size: 1.5rem;
      margin-bottom: 20px;
    }
    .equation-display {
      background: rgba(255,255,255,0.2);
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      font-size: 1.3rem;
      font-weight: 600;
      margin: 20px 0;
      border: 2px solid var(--glass-border);
    }
    .conditions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    .condition-card {
      background: rgba(255,255,255,0.1);
      padding: 15px;
      border-radius: 8px;
      border: 1px solid var(--glass-border);
    }
    .condition-card h4 {
      margin: 0 0 10px 0;
      color: var(--color4);
      font-size: 1rem;
    }
    .condition-card p {
      margin: 0;
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--color4);
    }
    .success-rate {
      background: linear-gradient(135deg, #4CAF50, #45a049);
      color: white;
      padding: 10px 15px;
      border-radius: 8px;
      text-align: center;
      font-weight: 600;
      margin: 15px 0;
    }
    .error {
      background: rgba(255,0,0,0.1);
      border: 1px solid rgba(255,0,0,0.3);
      color: #d32f2f;
      padding: 15px;
      border-radius: 8px;
    }
    .loading {
      text-align: center;
      color: var(--color4);
      font-size: 1.1rem;
    }
    .selected-elements {
      background: rgba(229,173,168,0.2);
      padding: 10px 15px;
      border-radius: 8px;
      margin: 15px 0;
      border: 1px solid var(--glass-border);
    }
    .selected-elements strong {
      color: var(--color4);
    }
    footer {
      background: var(--glass-bg);
      color: var(--color4);
      text-align: center;
      padding: 1.5rem 0 1rem 0;
      margin-top: 2rem;
      border-top: 1.5px solid var(--glass-border);
      box-shadow: 0 -8px 32px 0 rgba(114,92,63,0.10);
      backdrop-filter: blur(16px) saturate(1.2);
      -webkit-backdrop-filter: blur(16px) saturate(1.2);
    }
    .selected-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }
    
    .selected-item {
      background: var(--color1);
      color: var(--color4);
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .selected-item .remove {
      background: none;
      border: none;
      color: var(--color4);
      cursor: pointer;
      font-size: 1.2rem;
      padding: 0;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .temperature-toggle {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
      padding: 1rem;
      background: var(--glass-bg);
      border-radius: 12px;
      border: 1px solid var(--glass-border);
    }
    
    .temperature-toggle label {
      font-weight: 600;
      color: var(--color4);
    }
    
    .toggle-buttons {
      display: flex;
      gap: 0.5rem;
    }
    
    .temp-btn {
      background: var(--color2);
      color: var(--color4);
      border: 2px solid var(--glass-border);
      border-radius: 8px;
      padding: 0.5rem 1rem;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
    }
    
    .temp-btn.active {
      background: var(--color1);
      border-color: var(--color1);
      color: var(--color4);
    }
    
    .temp-btn:hover {
      background: var(--color3);
      transform: translateY(-1px);
    }
    
    @media (max-width: 800px) {
      main {
        padding: 1.2rem 0.5rem;
        margin: 2rem 1rem;
      }
      .header-left {
        gap: 1rem;
      }
      .header-right {
        gap: 0.8rem;
      }
      .nav-btn {
        padding: 0.6rem 1rem;
        font-size: 0.9rem;
      }
      .logo {
        font-size: 2rem;
      }
      .conditions-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.min.js"></script>
  <script src="https://unpkg.com/kekule/dist/kekule.js?module"></script>
  <link rel="stylesheet" href="https://unpkg.com/kekule/dist/themes/default/kekule.css">
</head>
<body>
  <canvas class="bg-bubbles" id="bg-bubbles"></canvas>
  <header>
    <div class="header-left">
      <a href="index.html" style="text-decoration:none;"><div class="logo logo-text">depHy</div></a>
      <canvas id="molecule-canvas"></canvas>
    </div>
    <div class="header-right">
      <a href="index.html#services" class="nav-btn">Services</a>
      <a href="index.html#about" class="nav-btn primary">About</a>
      <a href="index.html#contact" class="nav-btn contact-btn">Contact</a>
    </div>
  </header>
  <main>
    <h1>Get Started with depHy</h1>
    <div class="desc">Select the molecules or elements you want to react, and we'll provide optimal conditions and balanced equations.</div>
    <button id="examplesBtn" style="margin: 0 auto 1.5rem auto; display: block; background: var(--color3); color: var(--color4); border: none; border-radius: 10px; padding: 0.8rem 2rem; font-size: 1.1rem; font-weight: 600; box-shadow: 0 2px 8px rgba(114,92,63,0.10); cursor: pointer; transition: background 0.3s, transform 0.2s;">Examples & Charge Rules</button>
    <div id="examplesModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(229,224,216,0.45); z-index:10000; backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);">
      <div style="max-width: 540px; margin: 5vh auto; background: var(--glass-bg); border-radius: 18px; box-shadow: 0 8px 32px 0 rgba(114,92,63,0.18); border: 1.5px solid var(--glass-border); padding: 2.2rem 2rem 1.5rem 2rem; position: relative;">
        <button id="closeExamplesModal" style="position:absolute; top:18px; right:18px; background:var(--color3); color:var(--color4); border:none; border-radius:8px; padding:0.4rem 1rem; font-size:1rem; font-weight:600; cursor:pointer;">Close</button>
        <h2 style="margin-top:0; color:var(--color4); font-size:1.5rem; text-align:center;">Reaction Examples & Charge Rules</h2>
        <div style="margin-bottom:1.2rem;">
          <strong>Common Reaction Examples:</strong>
          <ul style="margin:0.7rem 0 1.2rem 1.2rem;">
            <li>2H<sub>2</sub> + O<sub>2</sub> → 2H<sub>2</sub>O</li>
            <li>N<sub>2</sub> + 3H<sub>2</sub> → 2NH<sub>3</sub></li>
            <li>C + O<sub>2</sub> → CO<sub>2</sub></li>
            <li>2Na + Cl<sub>2</sub> → 2NaCl</li>
            <li>HCl + NaOH → NaCl + H<sub>2</sub>O</li>
            <li>Zn + 2HCl → ZnCl<sub>2</sub> + H<sub>2</sub></li>
            <li>AgNO<sub>3</sub> + NaCl → AgCl↓ + NaNO<sub>3</sub></li>
          </ul>
        </div>
        <div style="margin-bottom:1.2rem;">
          <strong>Common Ion Charges (AP Chem):</strong>
          <table style="width:100%; border-collapse:collapse; background:rgba(255,255,255,0.15); border-radius:8px;">
            <tr><th style="text-align:left; padding:4px;">Element/Ion</th><th style="text-align:left; padding:4px;">Charge</th></tr>
            <tr><td>Group 1 (Na, K, Li, etc.)</td><td>+1</td></tr>
            <tr><td>Group 2 (Ca, Mg, Ba, etc.)</td><td>+2</td></tr>
            <tr><td>Aluminum (Al)</td><td>+3</td></tr>
            <tr><td>Silver (Ag)</td><td>+1</td></tr>
            <tr><td>Zinc (Zn)</td><td>+2</td></tr>
            <tr><td>Iron (Fe)</td><td>+2 or +3</td></tr>
            <tr><td>Copper (Cu)</td><td>+1 or +2</td></tr>
            <tr><td>Nonmetals (F, Cl, Br, I)</td><td>-1</td></tr>
            <tr><td>Oxygen (O)</td><td>-2</td></tr>
            <tr><td>Nitrogen (N)</td><td>-3 (in nitrides)</td></tr>
            <tr><td>Sulfur (S)</td><td>-2</td></tr>
          </table>
        </div>
        <div style="text-align:center; margin-bottom:1.2rem;">
          <button id="showPeriodicTableBtn" style="background: var(--color3); color: var(--color4); border: none; border-radius: 8px; padding: 0.7rem 1.5rem; font-size: 1.05rem; font-weight: 600; cursor: pointer; box-shadow: 0 2px 8px rgba(114,92,63,0.10); transition: background 0.2s;">Periodic Table</button>
        </div>

        <!-- Periodic Table Modal -->
        <div id="periodicTableModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(229,224,216,0.45); z-index:10001; backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);">
          <div style="max-width: 700px; margin: 6vh auto; background: var(--glass-bg); border-radius: 18px; box-shadow: 0 8px 32px 0 rgba(114,92,63,0.18); border: 1.5px solid var(--glass-border); padding: 2.2rem 2rem 1.5rem 2rem; position: relative; text-align:center;">
            <button id="closePeriodicTableModal" style="position:absolute; top:18px; right:18px; background:var(--color3); color:var(--color4); border:none; border-radius:8px; padding:0.4rem 1rem; font-size:1rem; font-weight:600; cursor:pointer;">Close</button>
            <h3 style="margin-top:0; color:var(--color4); font-size:1.3rem; text-align:center;">Periodic Table</h3>
            <img src="periodic table.jpg" alt="Periodic Table" style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(114,92,63,0.10); margin-top: 1rem;">
          </div>
        </div>
        <div style="font-size:0.98rem; color:var(--color4); margin-bottom:0.7rem;">
          <strong>Rule of Thumb:</strong> For a reaction to form a neutral compound, the total charge of all ions must sum to zero. For example, Na<sup>+</sup> (+1) and Cl<sup>-</sup> (-1) combine to make NaCl (0 net charge).<br>
          <em>Try combining a metal (positive charge) with a nonmetal (negative charge) for classic synthesis reactions!</em>
        </div>
      </div>
    </div>
    <div class="molecule-selection">
      <p><strong>Choose the molecules or elements you want to react:</strong></p>
      
      <div class="molecule-grid">
        <!-- Gases -->
        <div class="molecule-category">
          <h4>Gases</h4>
          <label><input type="checkbox" value="H2"> H₂ (Hydrogen)</label>
          <label><input type="checkbox" value="O2"> O₂ (Oxygen)</label>
          <label><input type="checkbox" value="N2"> N₂ (Nitrogen)</label>
          <label><input type="checkbox" value="Cl2"> Cl₂ (Chlorine)</label>
          <label><input type="checkbox" value="Br2"> Br₂ (Bromine)</label>
          <label><input type="checkbox" value="CO2"> CO₂ (Carbon Dioxide)</label>
          <label><input type="checkbox" value="CO"> CO (Carbon Monoxide)</label>
          <label><input type="checkbox" value="SO2"> SO₂ (Sulfur Dioxide)</label>
          <label><input type="checkbox" value="NO"> NO (Nitric Oxide)</label>
          <label><input type="checkbox" value="NH3"> NH₃ (Ammonia)</label>
          <label><input type="checkbox" value="HCl"> HCl (Hydrogen Chloride)</label>
          <label><input type="checkbox" value="HBr"> HBr (Hydrogen Bromide)</label>
          <label><input type="checkbox" value="H2S"> H₂S (Hydrogen Sulfide)</label>
        </div>
        
        <!-- Metals -->
        <div class="molecule-category">
          <h4>Metals</h4>
          <label><input type="checkbox" value="Na"> Na (Sodium)</label>
          <label><input type="checkbox" value="K"> K (Potassium)</label>
          <label><input type="checkbox" value="Ca"> Ca (Calcium)</label>
          <label><input type="checkbox" value="Mg"> Mg (Magnesium)</label>
          <label><input type="checkbox" value="Al"> Al (Aluminum)</label>
          <label><input type="checkbox" value="Fe"> Fe (Iron)</label>
          <label><input type="checkbox" value="Cu"> Cu (Copper)</label>
          <label><input type="checkbox" value="Zn"> Zn (Zinc)</label>
          <label><input type="checkbox" value="Ag"> Ag (Silver)</label>
          <label><input type="checkbox" value="Au"> Au (Gold)</label>
          <label><input type="checkbox" value="Li"> Li (Lithium)</label>
          <label><input type="checkbox" value="Ba"> Ba (Barium)</label>
          <label><input type="checkbox" value="Sr"> Sr (Strontium)</label>
        </div>
        
        <!-- Non-metals -->
        <div class="molecule-category">
          <h4>Non-metals</h4>
          <label><input type="checkbox" value="C"> C (Carbon)</label>
          <label><input type="checkbox" value="S"> S (Sulfur)</label>
          <label><input type="checkbox" value="P"> P (Phosphorus)</label>
          <label><input type="checkbox" value="I2"> I₂ (Iodine)</label>
          <label><input type="checkbox" value="F2"> F₂ (Fluorine)</label>
          <label><input type="checkbox" value="Si"> Si (Silicon)</label>
          <label><input type="checkbox" value="B"> B (Boron)</label>
        </div>
        
        <!-- Compounds -->
        <div class="molecule-category">
          <h4>Common Compounds</h4>
          <label><input type="checkbox" value="H2O"> H₂O (Water)</label>
          <label><input type="checkbox" value="NaOH"> NaOH (Sodium Hydroxide)</label>
          <label><input type="checkbox" value="KOH"> KOH (Potassium Hydroxide)</label>
          <label><input type="checkbox" value="Ca(OH)2"> Ca(OH)₂ (Calcium Hydroxide)</label>
          <label><input type="checkbox" value="H2SO4"> H₂SO₄ (Sulfuric Acid)</label>
          <label><input type="checkbox" value="HNO3"> HNO₃ (Nitric Acid)</label>
          <label><input type="checkbox" value="HCl"> HCl (Hydrochloric Acid)</label>
          <label><input type="checkbox" value="CH3COOH"> CH₃COOH (Acetic Acid)</label>
          <label><input type="checkbox" value="NaCl"> NaCl (Sodium Chloride)</label>
          <label><input type="checkbox" value="KCl"> KCl (Potassium Chloride)</label>
          <label><input type="checkbox" value="CaCl2"> CaCl₂ (Calcium Chloride)</label>
          <label><input type="checkbox" value="FeCl3"> FeCl₃ (Iron(III) Chloride)</label>
          <label><input type="checkbox" value="CuSO4"> CuSO₄ (Copper Sulfate)</label>
          <label><input type="checkbox" value="AgNO3"> AgNO₃ (Silver Nitrate)</label>
          <label><input type="checkbox" value="ZnCl2"> ZnCl₂ (Zinc Chloride)</label>
          <label><input type="checkbox" value="AlCl3"> AlCl₃ (Aluminum Chloride)</label>
          <label><input type="checkbox" value="MgCl2"> MgCl₂ (Magnesium Chloride)</label>
        </div>
      </div>
      
      <div class="selected-molecules">
        <h4>Selected Molecules: <span id="selected-count">0</span></h4>
        <div id="selected-list" class="selected-list"></div>
      </div>
    </div>
    <form id="predictionForm">
      <div class="temperature-toggle">
        <label>Temperature Unit:</label>
        <div class="toggle-buttons">
          <button type="button" class="temp-btn active" data-unit="celsius">°C</button>
          <button type="button" class="temp-btn" data-unit="kelvin">K</button>
        </div>
      </div>
      <button type="submit" id="submitBtn">Find Optimal Reaction Conditions</button>
    </form>
    <div id="result" class="result" style="display: none;">
      <h3>Prediction Results</h3>
      <div id="resultContent"></div>
    </div>
  </main>
  <footer>
  </footer>
  <!-- Cost/Savings display will be injected below the prediction results -->
  <script>
    // 3D Molecule Animation using Three.js (same as index.html)
    const canvas = document.getElementById('molecule-canvas');
    const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
    renderer.setClearColor(0x000000, 0); // transparent
    renderer.setSize(90, 90);
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(45, 1, 0.1, 100);
    camera.position.z = 7;
    const atomMaterial1 = new THREE.MeshPhongMaterial({ color: 0xE5ADA8 });
    const atomMaterial2 = new THREE.MeshPhongMaterial({ color: 0x725C3F });
    const atomMaterial3 = new THREE.MeshPhongMaterial({ color: 0xD0A77B });
    const atomGeometry = new THREE.SphereGeometry(0.6, 32, 32);
    const atom1 = new THREE.Mesh(atomGeometry, atomMaterial1);
    atom1.position.set(-1.2, 0, 0);
    const atom2 = new THREE.Mesh(atomGeometry, atomMaterial2);
    atom2.position.set(1.2, 0, 0);
    const atom3 = new THREE.Mesh(atomGeometry, atomMaterial3);
    atom3.position.set(0, 1.2, 0);
    scene.add(atom1, atom2, atom3);
    function createBond(start, end, color) {
      const dir = new THREE.Vector3().subVectors(end, start);
      const length = dir.length();
      const bondGeometry = new THREE.CylinderGeometry(0.15, 0.15, length, 16);
      const bondMaterial = new THREE.MeshPhongMaterial({ color });
      const bond = new THREE.Mesh(bondGeometry, bondMaterial);
      bond.position.copy(start).add(end).multiplyScalar(0.5);
      bond.lookAt(end);
      bond.rotateX(Math.PI / 2);
      return bond;
    }
    scene.add(
      createBond(atom1.position, atom2.position, 0xEFE8D8),
      createBond(atom1.position, atom3.position, 0xD8D7B2),
      createBond(atom2.position, atom3.position, 0xE5E0D8)
    );
    const light1 = new THREE.PointLight(0xffffff, 0.8);
    light1.position.set(5, 5, 10);
    scene.add(light1);
    const light2 = new THREE.AmbientLight(0xffffff, 0.5);
    scene.add(light2);
    function animate() {
      atom1.rotation.y += 0.01;
      atom2.rotation.y += 0.01;
      atom3.rotation.y += 0.01;
      scene.rotation.y += 0.008;
      renderer.render(scene, camera);
      requestAnimationFrame(animate);
    }
    animate();
    // Animated glassmorphism background bubbles (same as index.html)
    const bgBubbles = document.getElementById('bg-bubbles');
    if (bgBubbles && bgBubbles.getContext) {
      bgBubbles.width = window.innerWidth;
      bgBubbles.height = window.innerHeight;
      const ctx = bgBubbles.getContext('2d');
      let bubbles = Array.from({length: 18}, (_,i) => ({
        x: Math.random()*bgBubbles.width,
        y: Math.random()*bgBubbles.height,
        r: 30+Math.random()*40,
        vy: 0.2+Math.random()*0.3,
        color: i%3===0 ? '#E5ADA8' : (i%3===1 ? '#EFE8D8' : '#D8D7B2'),
        alpha: 0.13+Math.random()*0.09
      }));
      function drawBubbles() {
        ctx.clearRect(0,0,bgBubbles.width,bgBubbles.height);
        bubbles.forEach(b => {
          ctx.save();
          ctx.globalAlpha = b.alpha;
          ctx.beginPath();
          ctx.arc(b.x, b.y, b.r, 0, 2*Math.PI);
          ctx.fillStyle = b.color;
          ctx.shadowColor = b.color;
          ctx.shadowBlur = 18;
          ctx.fill();
          ctx.restore();
        });
      }
      function animateBubbles() {
        bubbles.forEach(b => {
          b.y -= b.vy;
          if (b.y + b.r < 0) {
            b.y = bgBubbles.height + b.r;
            b.x = Math.random()*bgBubbles.width;
          }
        });
        drawBubbles();
        requestAnimationFrame(animateBubbles);
      }
      animateBubbles();
      window.addEventListener('resize', () => {
        bgBubbles.width = window.innerWidth;
        bgBubbles.height = window.innerHeight;
      });
    }
    // Global variables for temperature unit and selected molecules
    let currentTempUnit = 'celsius';
    let selectedMolecules = new Set();
    let lastApiData = null;

    // Handle checkbox selection for molecule/element selection
    document.querySelectorAll('.molecule-category input[type="checkbox"]').forEach(checkbox => {
      checkbox.addEventListener('change', function() {
        if (this.checked) {
          selectedMolecules.add(this.value);
        } else {
          selectedMolecules.delete(this.value);
        }
        updateSelectedDisplay();
      });
    });
    
    // Handle temperature unit toggle (Celsius/Kelvin)
    document.querySelectorAll('.temp-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.temp-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        currentTempUnit = this.dataset.unit;
        if (lastApiData) {
          renderResults(lastApiData);
        }
      });
    });
    
    // Update the display of selected molecules
    function updateSelectedDisplay() {
      const count = selectedMolecules.size;
      document.getElementById('selected-count').textContent = count;
      
      const selectedList = document.getElementById('selected-list');
      selectedList.innerHTML = '';
      
      selectedMolecules.forEach(molecule => {
        const item = document.createElement('div');
        item.className = 'selected-item';
        item.innerHTML = `
          ${molecule}
          <button class="remove" onclick="removeMolecule('${molecule}')">&times;</button>
        `;
        selectedList.appendChild(item);
      });
    }
    
    // Remove a molecule from the selection
    function removeMolecule(molecule) {
      selectedMolecules.delete(molecule);
      document.querySelector(`input[value="${molecule}"]`).checked = false;
      updateSelectedDisplay();
    }
    
    // Update temperature display (for future use)
    function updateTemperatureDisplay() {
      if (!reactionData) return;
      
      const tempCard = document.querySelector('.condition-card h4:contains("Optimal Temperature")');
      if (tempCard) {
        const card = tempCard.closest('.condition-card');
        const tempP = card.querySelector('p');
        const tempSmall = card.querySelector('small');
        
        if (currentTempUnit === 'celsius') {
          tempP.textContent = `${reactionData.optimal_conditions.temperature_celsius} °C`;
          tempSmall.textContent = `Range: ${reactionData.recommendations.temperature_range_celsius}`;
        } else {
          tempP.textContent = `${reactionData.optimal_conditions.temperature_kelvin} K`;
          tempSmall.textContent = `Range: ${reactionData.recommendations.temperature_range_kelvin}`;
        }
      }
    }
    
    const API_URL = "https://dephy-production.up.railway.app"; // Flask API URL

    // --- Accurate Cost Data (2024, Lab-Scale, per mole) ---
    // Source: Wikipedia, Sigma-Aldrich, Fisher, HPLC India, July 2024
    // Prices are for pure substances, small-quantity/lab scale, and rounded for clarity.
    // If a compound is not listed, a nominal value is used.
    const COST_PER_MOL = {
      'H2': 1.00,         // Hydrogen gas
      'O2': 0.50,         // Oxygen gas
      'N2': 0.20,         // Nitrogen gas
      'Cl2': 1.00,        // Chlorine gas
      'Br2': 20.00,       // Bromine liquid
      'C': 0.10,          // Carbon (graphite/coal)
      'S': 0.10,          // Sulfur
      'P': 5.00,          // Phosphorus
      'Na': 3.00,         // Sodium metal
      'K': 10.00,         // Potassium metal
      'Ca': 2.00,         // Calcium metal
      'Mg': 2.00,         // Magnesium metal
      'Al': 2.00,         // Aluminum
      'Fe': 0.50,         // Iron
      'Cu': 1.00,         // Copper
      'Zn': 1.50,         // Zinc
      'Ag': 25.00,        // Silver
      'Au': 2000.00,      // Gold
      'Li': 10.00,        // Lithium
      'Ba': 5.00,         // Barium
      'Sr': 10.00,        // Strontium
      'I2': 10.00,        // Iodine
      'F2': 50.00,        // Fluorine (not usually sold pure)
      'Si': 2.00,         // Silicon
      'B': 5.00,          // Boron
      'H2O': 0.01,        // Water
      'CO2': 0.05,        // Carbon dioxide
      'CO': 1.00,         // Carbon monoxide
      'SO2': 2.00,        // Sulfur dioxide
      'NO': 10.00,        // Nitric oxide
      'NH3': 0.50,        // Ammonia
      'HCl': 0.50,        // Hydrochloric acid (1M)
      'HBr': 5.00,        // Hydrobromic acid (1M)
      'H2S': 5.00,        // Hydrogen sulfide
      'NaOH': 0.50,       // Sodium hydroxide
      'KOH': 1.00,        // Potassium hydroxide
      'Ca(OH)2': 1.00,    // Calcium hydroxide
      'H2SO4': 0.50,      // Sulfuric acid (1M)
      'HNO3': 0.50,       // Nitric acid (1M)
      'CH3COOH': 0.50,    // Acetic acid (glacial)
      'NaCl': 0.10,       // Sodium chloride
      'KCl': 0.20,        // Potassium chloride
      'CaCl2': 0.20,      // Calcium chloride
      'FeCl3': 0.50,      // Iron(III) chloride
      'CuSO4': 1.00,      // Copper(II) sulfate
      'AgNO3': 30.00,     // Silver nitrate
      'ZnCl2': 2.00,      // Zinc chloride
      'AlCl3': 2.00,      // Aluminum chloride
      'MgCl2': 1.00,      // Magnesium chloride
      // Add more as needed
    };
    // Default (wasteful) concentration assumed for each reactant (mol/L)
    const DEFAULT_CONC = 1.0;
    // Calculate and display cost/savings for a reaction
    function showCostSummary(concA, concB, elA, elB) {
      // Look up cost per mol for each reactant, default to $10 if not found
      const costA = COST_PER_MOL[elA] || 10;
      const costB = COST_PER_MOL[elB] || 10;
      // Calculate costs
      const usedA = concA * costA;
      const usedB = concB * costB;
      const defaultA = DEFAULT_CONC * costA;
      const defaultB = DEFAULT_CONC * costB;
      const totalUsed = usedA + usedB;
      const totalDefault = defaultA + defaultB;
      const savings = Math.max(0, totalDefault - totalUsed);
      // Build HTML summary
      let savingsBox = '';
      if (savings > 0) {
        savingsBox = `
          <div style="margin-top:1.2rem;text-align:center;">
            <span style="font-size:1.7rem;font-weight:900;color:var(--color3);letter-spacing:0.5px;display:inline-block;background:rgba(255,255,255,0.35);backdrop-filter:blur(4px);padding:0.6rem 1.5rem;border-radius:2rem;box-shadow:0 2px 8px rgba(208,167,123,0.10);border:1.2px solid rgba(208,167,123,0.18);">
              You saved $${savings.toFixed(2)} on materials for this reaction!
            </span>
          </div>
        `;
      }
      const html = `
        <div id="costSummary" style="margin-top:2rem;margin-bottom:1.5rem;background:var(--color1);color:var(--color4);padding:1.2rem 1.5rem;border-radius:1.2rem;box-shadow:0 2px 12px rgba(208,167,123,0.10);font-size:1.08rem;backdrop-filter:blur(8px);background:rgba(255,255,255,0.45);border:1.5px solid rgba(208,167,123,0.18);">
          <strong>Material Cost Breakdown:</strong><br>
          <span style="display:block;margin-top:0.5rem;">
            ${elA}: ${concA} mol × $${costA.toFixed(2)}/mol = $${usedA.toFixed(2)}<br>
            ${elB}: ${concB} mol × $${costB.toFixed(2)}/mol = $${usedB.toFixed(2)}
          </span>
          <span style="display:block;margin-top:0.5rem;">
            <em>Default material cost:</em> $${totalDefault.toFixed(2)} <span style="font-size:0.98em;opacity:0.85;">(assuming 1 mole of each reactant)</span><br>
            <em>Actual cost for this reaction:</em> $${totalUsed.toFixed(2)}<br>
            ${savingsBox}
          </span>
        </div>
      `;
      // Insert or update the summary below the results
      let summaryDiv = document.getElementById('costSummary');
      if (summaryDiv) {
        summaryDiv.outerHTML = html;
      } else {
        document.getElementById('result').insertAdjacentHTML('beforeend', html);
      }
    }

    // Render results from the API response
    function renderResults(data) {
      let html = '';
      if (data.balanced_equation) {
        html += `<div class="equation-display" style="background:rgba(255,255,255,0.25);border-radius:12px;padding:18px 0;font-size:1.5rem;font-weight:700;text-align:center;margin-bottom:18px;box-shadow:0 2px 12px rgba(208,167,123,0.10);letter-spacing:1px;">${data.balanced_equation}</div>`;
      }
      if (data.optimal_conditions && data.selected_elements && data.selected_elements.length >= 2) {
        const elA = data.selected_elements[0];
        const elB = data.selected_elements[1];
        let tempC = data.optimal_conditions.temperature;
        let tempK = (parseFloat(tempC) + 273.15).toFixed(2);
        let tempDisplay = currentTempUnit === 'kelvin' ? `${tempK} K` : `${tempC} °C`;
        html += `<div class="conditions-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:18px;margin:18px 0;">`;
        html += `<div class="condition-card" style="background:rgba(229,224,216,0.45);border-radius:12px;padding:18px;text-align:center;box-shadow:0 2px 8px rgba(208,167,123,0.08);"><h4 style="margin:0 0 8px 0;font-size:1.1rem;">Optimal Temperature</h4><p style="font-size:1.3rem;font-weight:600;">${tempDisplay}</p></div>`;
        html += `<div class="condition-card" style="background:rgba(229,224,216,0.45);border-radius:12px;padding:18px;text-align:center;box-shadow:0 2px 8px rgba(208,167,123,0.08);"><h4 style="margin:0 0 8px 0;font-size:1.1rem;">Optimal Pressure</h4><p style="font-size:1.3rem;font-weight:600;">${data.optimal_conditions.pressure} atm</p></div>`;
        html += `<div class="condition-card" style="background:rgba(229,224,216,0.45);border-radius:12px;padding:18px;text-align:center;box-shadow:0 2px 8px rgba(208,167,123,0.08);"><h4 style="margin:0 0 8px 0;font-size:1.1rem;">Concentration of ${elA}</h4><p style="font-size:1.3rem;font-weight:600;">${data.optimal_conditions.concentration_A} mol/L</p></div>`;
        html += `<div class="condition-card" style="background:rgba(229,224,216,0.45);border-radius:12px;padding:18px;text-align:center;box-shadow:0 2px 8px rgba(208,167,123,0.08);"><h4 style="margin:0 0 8px 0;font-size:1.1rem;">Concentration of ${elB}</h4><p style="font-size:1.3rem;font-weight:600;">${data.optimal_conditions.concentration_B} mol/L</p></div>`;
        html += `<div class="condition-card" style="background:rgba(229,224,216,0.45);border-radius:12px;padding:18px;text-align:center;box-shadow:0 2px 8px rgba(208,167,123,0.08);"><h4 style="margin:0 0 8px 0;font-size:1.1rem;">Recommended Catalyst</h4><p style="font-size:1.3rem;font-weight:600;">${data.optimal_conditions.catalyst}</p></div>`;
        html += `<div class="condition-card" style="background:rgba(229,224,216,0.45);border-radius:12px;padding:18px;text-align:center;box-shadow:0 2px 8px rgba(208,167,123,0.08);"><h4 style="margin:0 0 8px 0;font-size:1.1rem;">Expected Success Rate</h4><p style="font-size:1.3rem;font-weight:600;">${(data.optimal_conditions.success_rate*100).toFixed(1)}%</p></div>`;
        html += `</div>`;
        // Show cost/savings summary for this reaction
        showCostSummary(data.optimal_conditions.concentration_A, data.optimal_conditions.concentration_B, elA, elB);
      }
      if (data.notes) {
        html += `<div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px;">
          <h4 style="margin-top: 0; color: var(--color4);">Reaction Notes:</h4>
          <div>${data.notes}</div>
        </div>`;
      }
      html += `<div style="text-align:center; margin-top: 24px;"><button id="needHelpBtn" style="background: var(--color1); color: var(--color4); border: none; border-radius: 8px; padding: 0.7rem 1.5rem; font-size: 1.05rem; font-weight: 600; cursor: pointer; box-shadow: 0 2px 8px rgba(114,92,63,0.10); transition: background 0.2s;">Definitions</button></div>`;
      document.getElementById('resultContent').innerHTML = html;

      // Attach event listener for Definitions button immediately after rendering
      const needHelpBtn = document.getElementById('needHelpBtn');
      if (needHelpBtn) {
        needHelpBtn.onclick = function() {
          document.getElementById('helpModal').style.display = 'block';
        };
      }
    }

    // --- Element-based Prediction Form Handler ---
    // Handles form submission for element-based prediction
    document.getElementById('predictionForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const submitBtn = document.getElementById('submitBtn');
      const resultDiv = document.getElementById('result');
      const resultContent = document.getElementById('resultContent');
      // Get selected elements from checkboxes
      const selectedElements = Array.from(selectedMolecules);
      if (selectedElements.length < 2) {
        resultDiv.style.display = 'block';
        resultContent.innerHTML = '<div class="error"><strong>Error:</strong> Please select at least 2 elements to react.</div>';
        return;
      }
      // Show loading state
      submitBtn.disabled = true;
      submitBtn.textContent = 'Analyzing Reaction...';
      resultDiv.style.display = 'block';
      resultContent.innerHTML = '<div class="loading">Finding optimal reaction conditions...</div>';
      const formData = {
        elements: selectedElements
      };
      try {
        // Check API status before making the request
        const pingRes = await fetch(API_URL + '/ping');
        if (!pingRes.ok) throw new Error('API not available');
        // Make POST request to Flask API
        const response = await fetch(API_URL + '/predict-reaction', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });
        const data = await response.json();
        if (response.ok) {
          lastApiData = data;
          renderResults(data);
          resultDiv.className = 'result';
        } else {
          resultContent.innerHTML = `<div class="error"><strong>Error:</strong> ${data.error}</div>`;
          resultDiv.className = 'result error';
        }
      } catch (error) {
        // Handle network or server errors
        resultContent.innerHTML = `
          <div class="error">
            <strong>Connection Error:</strong> Could not connect to the API. 
            Make sure the Flask server is running on <code>${API_URL}</code>
          </div>
        `;
        resultDiv.className = 'result error';
      } finally {
        // Reset button state
        submitBtn.disabled = false;
        submitBtn.textContent = 'Find Optimal Reaction Conditions';
      }
    });

    document.getElementById('examplesBtn').addEventListener('click', function() {
      document.getElementById('examplesModal').style.display = 'block';
    });
    document.getElementById('closeExamplesModal').addEventListener('click', function() {
      document.getElementById('examplesModal').style.display = 'none';
    });
    window.addEventListener('click', function(e) {
      const modal = document.getElementById('examplesModal');
      if (e.target === modal) modal.style.display = 'none';
    });

    // Periodic Table Modal Logic
    document.getElementById('showPeriodicTableBtn').addEventListener('click', function() {
      document.getElementById('periodicTableModal').style.display = 'block';
    });
    document.getElementById('closePeriodicTableModal').addEventListener('click', function() {
      document.getElementById('periodicTableModal').style.display = 'none';
    });
    window.addEventListener('click', function(e) {
      const modal = document.getElementById('periodicTableModal');
      if (e.target === modal) modal.style.display = 'none';
    });

    // Add Need Help Modal to the page if not already present
    if (!document.getElementById('helpModal')) {
      const modal = document.createElement('div');
      modal.id = 'helpModal';
      modal.style.display = 'none';
      modal.style.position = 'fixed';
      modal.style.top = '0';
      modal.style.left = '0';
      modal.style.width = '100vw';
      modal.style.height = '100vh';
      modal.style.background = 'rgba(229,224,216,0.45)';
      modal.style.zIndex = '10001';
      modal.style.backdropFilter = 'blur(8px)';
      modal.style.webkitBackdropFilter = 'blur(8px)';
      modal.innerHTML = `
        <div style="max-width: 900px; margin: 7vh auto; background: var(--glass-bg); border-radius: 18px; box-shadow: 0 8px 32px 0 rgba(114,92,63,0.18); border: 1.5px solid var(--glass-border); padding: 2.2rem 2rem 1.5rem 2rem; position: relative; text-align:left;">
          <button id="closeHelpModal" style="position:absolute; top:18px; right:18px; background:var(--color3); color:var(--color4); border:none; border-radius:8px; padding:0.4rem 1rem; font-size:1rem; font-weight:600; cursor:pointer;">Close</button>
          <h3 style="margin-top:0; color:var(--color4); font-size:1.3rem; text-align:center;">Chemistry Terms Help</h3>
          <ul style="margin-top:1.5rem; font-size:1.08rem; color:var(--color4); line-height:1.7;">
            <li><strong>Exothermic:</strong> A reaction that releases heat to its surroundings.</li>
            <li><strong>Endothermic:</strong> A reaction that absorbs heat from its surroundings.</li>
            <li><strong>Synthesis:</strong> A reaction where two or more substances combine to form a single product.</li>
            <li><strong>Catalyst:</strong> A substance that speeds up a chemical reaction without being consumed.</li>
            <li><strong>Reactant:</strong> A starting substance in a chemical reaction.</li>
            <li><strong>Product:</strong> A substance formed as a result of a chemical reaction.</li>
            <li><strong>Ion:</strong> An atom or molecule with a net electric charge due to the loss or gain of electrons.</li>
            <li><strong>Precipitate:</strong> A solid that forms and settles out of a liquid mixture during a reaction.</li>
            <li><strong>Oxidation:</strong> The loss of electrons during a reaction by a molecule, atom, or ion.</li>
            <li><strong>Reduction:</strong> The gain of electrons during a reaction by a molecule, atom, or ion.</li>
            <li><strong>Equilibrium:</strong> The state in which the forward and reverse reactions occur at the same rate.</li>
            <li><strong>Concentration:</strong> The amount of a substance in a given volume.</li>
            <li><strong>Activation Energy:</strong> The minimum energy required to start a chemical reaction.</li>
            <li><strong>Heat:</strong> A form of energy that is transferred between systems or objects with different temperatures (flows from hot to cold).</li>
            <li><strong>Haber process:</strong> An industrial process for synthesizing ammonia (NH₃) from nitrogen (N₂) and hydrogen (H₂) gases under high temperature and pressure, using an iron catalyst.</li>
          </ul>
        </div>
      `;
      document.body.appendChild(modal);
    }
    // Add event listener for Need Help button
    setTimeout(() => {
      const needHelpBtn = document.getElementById('needHelpBtn');
      if (needHelpBtn) {
        needHelpBtn.onclick = function() {
          document.getElementById('helpModal').style.display = 'block';
        };
      }
      const closeHelpModal = document.getElementById('closeHelpModal');
      if (closeHelpModal) {
        closeHelpModal.onclick = function() {
          document.getElementById('helpModal').style.display = 'none';
        };
      }
      window.addEventListener('click', function(e) {
        const modal = document.getElementById('helpModal');
        if (e.target === modal) modal.style.display = 'none';
      });
    }, 0);
  </script>
</body>
</html> 